# Lesson_5 — Эстафетный бег через очереди сообщений

Две реализации одной задачи «эстафетный бег» с межпроцессным обменом:

- **Вариант A — System V message queues**: одна очередь, маршрутизация по `mtype`.
- **Вариант B — POSIX message queues**: именованные очереди — у каждого бегуна своя, у судьи своя.

## Сценарий
1. На стадион «приходят» бегуны (количество — аргумент командной строки) и судья.  
2. Судья ждёт всех бегунов (каждый отправляет «прибыл»).  
3. Судья передаёт палочку первому и запускает таймер.  
4. Бегун `i` получает палочку, «бежит» (небольшая задержка), передаёт `i+1`.  
5. Последний возвращает палочку судье, судья печатает время полного круга.

---


## Запуск

```bash
./stadium 8
# [SysV] N=8, время полного круга: 7.123 ms

./stadium_posix 8
# [POSIX] N=8, время полного круга: 6.842 ms
```

Аргумент — число бегунов `N > 0`.  
Задержка «бега» выставлена в коде (по умолчанию 5 ms на участника).



## Краткий обзор решений

### Вариант A — System V (одна очередь)
- `msgget(IPC_PRIVATE, IPC_CREAT|0600)` — создать очередь
- `msgsnd / msgrcv` — пересылка; маршрутизация по `mtype`:
  - прибытия: `mtype = 1`
  - палочка бегуну `i`: `mtype = 1000 + i`
  - возврат судье: `mtype = 2`
- `msgctl(..., IPC_RMID, ...)` — удаление

### Вариант B — POSIX mqueue (именованные)
- Очереди: `/judge_<PID>` и `/runner_<PID>_<i>`
- `mq_open / mq_send / mq_receive / mq_unlink`
- Уникальность имён через `getpid()` у процесса-судьи

---